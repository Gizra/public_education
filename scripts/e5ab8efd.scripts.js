"use strict";angular.module("publicEducationApp",["config","angular-audio-player","angularLocalStorage","leaflet-directive"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"ListMarkersCtrl"}).when("/add-marker",{templateUrl:"views/add-marker.html",controller:"AddMarkerCtrl"}).when("/play-marker/:venueId",{templateUrl:"views/play-marker.html",controller:"PlayMarkerCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}).otherwise({redirectTo:"/"}),delete b.defaults.headers.common["X-Requested-With"]}]),angular.module("config",[]).constant("ENV","development").constant("FOURDQUARE",{id:"IZPZNXG2P5A3H4EBIFFEMRAIBMXCNGM1ZZ2QUPN2D1WNKNGX",secret:"MZ0CZ4Z0PMAEAGKDPJ5DO0BI2M1FAMJXRGWMCWNCPC5MQ02U"}).constant("BACKEND_URL","http://localhost:3000"),angular.module("publicEducationApp").controller("ListMarkersCtrl",["$scope","Leaflet","storage",function(a,b,c){angular.extend(a,b.getDefaults()),c.bind(a,"center",{defaultValue:b.getCenter()}),angular.extend(a,{markers:{"513ee460e4b06c84bc3599d1":{lat:41.0383,lng:28.9869,message:"This is Gezi Parki",focus:!1,draggable:!1},marker2:{lat:41.0383,lng:28.96,message:"This is Barcelona. You can not drag me",focus:!1,draggable:!1}}}),angular.forEach(["zoomend","moveend"],function(c){a.$on("leafletDirectiveMap."+c,function(){b.setCenter(a.center)})})}]),angular.module("publicEducationApp").controller("AddMarkerCtrl",["$scope","Leaflet","Foursquare","storage","User",function(a,b,c,d,e){var f=function(){if(a.center.zoom>=16){var b=a.center.lat,d=a.center.lng;a.markers={marker:{lat:b,lng:d,draggable:!0,venue:null}},c.getVenue(b,d).then(function(b){a.markers.marker.venue=b})}else a.markers={}};angular.extend(a,b.getDefaults()),angular.forEach(["leafletDirectiveMap.zoomend","leafletDirectiveMap.moveend","leafletDirectiveMarker.dragend"],function(c){a.$on(c,function(c,d){"leafletDirectiveMarker.dragend"===c.name&&(a.center.lat=d.leafletEvent.target._latlng.lat,a.center.lng=d.leafletEvent.target._latlng.lng),f(),b.setCenter(a.center)})}),e.getUser().then(function(b){a.user=b}),a.setState=function(b){a.state=b},d.bind(a,"center",{defaultValue:b.getCenter()}),d.bind(a,"text"),d.bind(a,"markers"),f(),a.setState("mark")}]),angular.module("publicEducationApp").service("Leaflet",function(){return{data:{leaflet:{center:{lat:41.0383,lng:28.9869,zoom:16}},markers:{},marker:null},getDefaults:function(){return{defaults:{maxZoom:20,minZoom:14}}},getCenter:function(){return this.data.leaflet.center},setCenter:function(a){this.data.leaflet.center=a}}}),angular.module("publicEducationApp").service("Foursquare",["$http","$q","FOURDQUARE",function(a,b,c){return{getVenue:function(d,e){var f=b.defer();return a({method:"GET",url:"https://api.foursquare.com/v2/venues/search",params:{ll:d+","+e,v:20130917,client_id:c.id,client_secret:c.secret,limit:1},cache:!0}).success(function(a){f.resolve(a.response.venues[0])}),f.promise}}}]),angular.module("publicEducationApp").filter("venueName",function(){return function(a){return a?a:"Loading..."}}),angular.module("publicEducationApp").controller("PlayMarkerCtrl",["$scope","$routeParams","$location","Marker",function(a,b,c,d){a.venueId=b.venueId,angular.extend(a,{selectedMarker:{playList:[]}}),d.getMarkers().then(function(b){a.markers=b,a.markers[a.venueId]||c.path("/"),a.selectedMarker=a.markers[a.venueId]})}]),angular.module("publicEducationApp").controller("loginCtrl",["$scope","User","$location","BACKEND_URL",function(a,b,c,d){b.getUser().then(function(b){a.user=b}),a.backendUrl=d}]),angular.module("publicEducationApp").service("User",["$http","$q","BACKEND_URL",function(a,b,c){return{data:{user:null},getUser:function(){var d=b.defer();return a({method:"GET",url:c+"/account",cache:!0,withCredentials:!0}).success(function(a){d.resolve(a)}),d.promise}}}]),angular.module("publicEducationApp").service("Marker",["$q","$http","$timeout",function(a,b,c){return{data:{markers:[]},getMarkers:function(){var b=a.defer(),d={"513ee460e4b06c84bc3599d1":{name:"Topçular Semt Polikliniği",lat:41.0383,lng:28.9869,playList:[{src:"http://upload.wikimedia.org/wikipedia/en/7/79/Korn_-_Predictable_%28demo%29.ogg",text:"1st text",user:{name:"amitaibu",photo:"https://graph.facebook.com/amitai.burstein/picture"}},{src:"http://www.metadecks.org/software/sweep/audio/demos/vocal2.ogg",text:"2nd  text",user:{name:"Bruce",photo:"https://graph.facebook.com/brice.lenfant/picture"}},{src:"http://demos.w3avenue.com/html5-unleashed-tips-tricks-and-techniques/demo-audio.ogg",text:"3rd text",user:{}}]}};return c(function(){b.resolve(d)},500),b.promise}}}]);